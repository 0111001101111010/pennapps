//custom LeapGamer.com copyright James Blaha
//This software is copyrighted under an MIT license
//https://github.com/jquery/jquery/blob/master/MIT-LICENSE.txt
(function(e){var t=[],n,r=[],i,s=0,o,u,a=0,f=function(){},l=!1,c=0,h=0,p=0,d=200,v=250,m=470,g=!1,y=!1,b=!1,w=[],y=[],E=[],S=[],x=[],b=[],T=[],N=20,C=50,k=50,L=10,A=20,O={onHandEnter:f,onHandExit:f,onHandChange:f,onPointerChange:f,onFrame:f,onConnect:f,onDisconnect:f,onSecondChange:f,onTap:f,onPush:f,onWind:f,onPoke:f,onSwipe:f,onGrab:f,onWiggle:f},M={initLeap:function(){console.log("Loaded plugin!!");if(typeof window.Leap=="undefined"){typeof WebSocket=="undefined"&&typeof MozWebSocket!="undefined"&&(WebSocket=MozWebSocket);n=new WebSocket("ws://localhost:6437/");n.onopen=function(e){console.log("Connected to Leap device.");O.onConnect()};n.onmessage=function(t){window.leapData=e.parseJSON(t.data);e.fn.leap("leapFrame")};n.onclose=function(e){n=null;O.onDisconnect();console.log("Disconnected from Leap device.")};n.onerror=function(e){console.log("Error connecting to Leap device.")}}else{O.onConnect();var t={enableGestures:!1};window.Leap.loop(t,function(t){window.leapData=t;e.fn.leap("leapFrame")})}},leapFrame:function(){s++;i=window.leapData.timestamp-u;o=1/(i/1e6);window.leapData.pointables!=null&&(window.leapData.numPointables=window.leapData.pointables.length);window.leapData.hands!=null&&(window.leapData.numHands=window.leapData.hands.length);a>0&&window.leapData.numHands==0&&O.onHandExit();a==0&&window.leapData.numHands>0&&O.onHandEnter();a!==window.leapData.numHands&&O.onHandChange();c!==window.leapData.numPointables&&O.onPointerChange();Math.round(u/1e6)<Math.round(window.leapData.timestamp/1e6)&&O.onSecondChange();if(s==3){h=window.leapData.timestamp;for(var t=0;t<20;t++)w[t]=!1;for(var t=0;t<5;t++){y[t]=[];y[t].isPushing=!1;y[t].lastPalm=-600;b[t]=[];b[t].isSwiping=!1;b[t].lastPalm=-600;T[t]=[];T.history=[];T.frames=0}}window.leapData.fps=o;window.leapData.timeBegan=h;window.leapData.deltaTime=i;window.leapData.frameCount=s;window.leapData.timeElapsed=window.leapData.timestamp-h;window.leapData.numPointables>0&&r.onTap!=f&&e.each(window.leapData.pointables,function(e,t){t.tipVelocity[1]<-1e3&&w[e]==0&&(w[e]=s);w[e]!=0&&s-w[e]>N&&(w[e]=!1);if(t.tipVelocity[1]>100&&w[e]!=0){w[e]=!1;O.onTap(t)}});window.leapData.numHands>0&&r.onPush!=f&&e.each(window.leapData.hands,function(e,t){var n=t.palmVelocity[2],r=t.palmPosition[2];if(n<-1200&&y[e].isPushing==0&&y[e].lastPalm<r){y[e].frameStarted=s;y[e].isPushing=!0}if(typeof y[e]!="undefined"){y[e].isPushing&&s-y[e].frameStarted>C&&(y[e].isPushing=!1);if(y[e].isPushing!=0&&n>-10){y[e].isPushing=!1;O.onPush(t)}y[e].lastPalm=r}});window.leapData.numPointables>0&&O.onWind!=f&&e.each(window.leapData.pointables,function(e,t){});if(window.leapData.numHands==0)for(var t=0;t<5;t++){T[t]=[];T.history=[];T.frames=0}window.leapData.numHands>0&&O.onGrab!=f&&e.each(window.leapData.hands,function(e,t){if(typeof T[e]!="undefined"){window.leapData.numPointables==0&&(T[e].palmOpen=!1);window.leapData.numPointables>1&&(T[e].grabbing=!1);window.leapData.numPointables>2&&(T[e].palmOpen=!0);var n=!1;for(var r=0;r<L;r++)typeof T.history!="undefined"&&T.history[r]&&(n=!0);if(!T[e].palmOpen&&(n||T[e].grabbing)&&Math.abs(t.palmPosition[0])<d&&t.palmPosition[2]<v&&t.palmPosition[1]<m){T[e].grabbing=!0;O.onGrab(t)}T.history[T.frames]=T[e].palmOpen;T.frames++;T.frames==L&&(T.frames=0)}});window.leapData.numHands>0&&O.onSwipe!=f&&e.each(window.leapData.hands,function(e,t){var n=t.palmVelocity[0],r=t.palmPosition[0];if(n<0){if(n<-1e3&&b[e].isSwiping==0&&b[e].lastPalm>r){b[e].frameStarted=s;b[e].isSwiping=!0;b[e].direction="left"}}else if(n>1e3&&b[e].isSwiping==0&&b[e].lastPalm<r){b[e].frameStarted=s;b[e].isSwiping=!0;b[e].direction="right"}b[e].isSwiping&&s-b[e].frameStarted>k&&(b[e].isSwiping=!1);if(b[e].isSwiping!=0&&n<0){b[e].isSwiping=!1;t.direction=b[e].direction;O.onSwipe(t)}b[e].lastPalm=r});window.leapData.numPointables>0&&O.onPoke!=f&&e.each(window.leapData.pointables,function(e,t){t.tipVelocity[2]<-1e3&&x[e]==0&&(x[e]=s);x[e]!=0&&s-x[e]>A&&(x[e]=!1);if(t.tipVelocity[2]>100&&x[e]!=0){x[e]=!1;O.onPoke(t)}});window.leapData.numPointables>0&&O.onWiggle!=f&&e.each(window.leapData.pointables,function(e,t){});O.onFrame();window.leapData.lastFrameHands=window.leapData.numHands;a=window.leapData.numHands;window.leapData.lastFrameTime=window.leapData.timestamp;u=window.leapData.timestamp;c=window.leapData.numPointables},setEvent:function(e,t){O[e]=t},setEvents:function(t,n){e.each(t,function(e,t){O[e]=t});if(typeof n!="undefined"&&typeof n.Leap!="undefined"){window.Leap=n.Leap;console.log("options leap is set");typeof n.controllerOptions=="undefined"?window.controllerOptions={enableGestures:!1}:window.controllerOptions=n.controllerOptions}},data:function(){return window.leapData},setData:function(e){window.leapData=e}};e.fn.leap=function(t){if(!l){l=!0;e.fn.leap("initLeap")}t==undefined&&(t="data");if(M[t])return M[t].apply(this,Array.prototype.slice.call(arguments,1));if(typeof t=="object"||!t)return M.init.apply(this,arguments);e.error("Method "+t+" does not exist on jQuery.leap")}})(jQuery);